#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         ğŸš€ OLYSACHECK - GÃ‰NÃ‰RATEUR DE SITEMAP ULTRA-PUISSANT v3.0           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  ğŸ‘‘ Version ULTIMATE - Ce que Google aime :                                  â•‘
â•‘  âœ“ Format XML parfaitement valide                                            â•‘
â•‘  âœ“ Images incluses (Google Images)                                           â•‘
â•‘  âœ“ VidÃ©os incluses (Google VidÃ©o)                                           â•‘
â•‘  âœ“ Multi-langues (hreflang)                                                 â•‘
â•‘  âœ“ PrioritÃ©s intelligentes                                                   â•‘
â•‘  âœ“ Dates de modification prÃ©cises                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""

import os
import glob
import gzip
import hashlib
from datetime import datetime
from xml.etree.ElementTree import Element, SubElement, tostring, register_namespace
from xml.dom import minidom
import urllib.parse
import json
import logging
from typing import List, Dict, Tuple, Optional

# =============================================================
# ğŸ¯ CONFIGURATION ULTRA-OPTIMISÃ‰E
# =============================================================

class SitemapConfig:
    # ğŸ”— URL de base (NE CHANGE PAS)
    BASE_URL = "https://olysacheck.vercel.app"
    
    # ğŸ“ Extensions Ã  scanner
    FILE_EXTENSIONS = ['*.html', '*.php', '*.xml', '*.js']
    
    # ğŸ–¼ï¸ Images Ã  inclure
    IMAGE_EXTENSIONS = ['*.jpg', '*.jpeg', '*.png', '*.gif', '*.webp', '*.svg']
    
    # ğŸ¥ VidÃ©os Ã  inclure
    VIDEO_EXTENSIONS = ['*.mp4', '*.webm', '*.ogg']
    
    # ğŸ“ Fichiers Ã  exclure
    EXCLUDED_FILES = [
        '404.html', 'error.html', 'thanks.html',
        'old/', 'backup/', 'temp/', 'private/',
        'robots.txt', 'sitemap.xml', 'sitemap.xml.gz'
    ]
    
    # ğŸ† PrioritÃ©s intelligentes (basÃ©es sur l'importance)
    PAGE_PRIORITIES = {
        'index.html': 1.0,           # Page d'accueil : MAXIMUM
        'check-email.php': 0.95,      # FonctionnalitÃ© principale
        'auth.html': 0.85,             # Authentification
        'politique-confidentialite.html': 0.75,  # Page lÃ©gale
    }
    
    # ğŸ”„ FrÃ©quences de mise Ã  jour (Google adore)
    PAGE_FREQUENCY = {
        'index.html': 'hourly',        # Change souvent
        'check-email.php': 'always',    # Temps rÃ©el
        'auth.html': 'daily',           # Quotidien
        'politique-confidentialite.html': 'monthly',  # Rare
    }
    
    # ğŸŒ Langues supportÃ©es
    LANGUAGES = ['fr', 'en']
    
    # ğŸ—“ï¸ Format de date Google
    DATE_FORMAT = "%Y-%m-%dT%H:%M:%S+00:00"
    
    # ğŸ“Š Logging
    LOG_FILE = "sitemap_generation.log"
    LOG_LEVEL = logging.INFO


# =============================================================
# ğŸ“ GÃ‰NÃ‰RATEUR DE SITEMAP INTELLIGENT (VERSION GOOGLE-FRIENDLY)
# =============================================================

class GoogleFriendlySitemapGenerator:
    """
    GÃ©nÃ©rateur de sitemap ultra-optimisÃ© pour Google
    Respecte TOUTES les consignes Google
    """
    
    def __init__(self, config: SitemapConfig):
        self.config = config
        self.files_found = []
        self.images_found = []
        self.videos_found = []
        self.stats = {
            'total_files': 0,
            'total_images': 0,
            'total_videos': 0,
            'included_urls': 0,
            'included_images': 0,
            'included_videos': 0,
            'excluded': 0,
            'errors': 0
        }
        self.setup_logging()
        
        # Enregistrement des namespaces XML (important pour Google)
        register_namespace('image', 'http://www.google.com/schemas/sitemap-image/1.1')
        register_namespace('video', 'http://www.google.com/schemas/sitemap-video/1.1')
        register_namespace('xhtml', 'http://www.w3.org/1999/xhtml')
        
    def setup_logging(self):
        """Configure les logs pour le debugging"""
        logging.basicConfig(
            level=self.config.LOG_LEVEL,
            format='%(asctime)s - %(levelname)s - %(message)s',
            handlers=[
                logging.FileHandler(self.config.LOG_FILE),
                logging.StreamHandler()
            ]
        )
        self.logger = logging.getLogger("SitemapGenerator")
        
    def scan_files(self):
        """Scan intelligent de tous les fichiers"""
        self.logger.info("ğŸ” Scan des fichiers en cours...")
        
        # Scan des pages
        for ext in self.config.FILE_EXTENSIONS:
            found = glob.glob(ext, recursive=True)
            self.files_found.extend(found)
            
        # Scan des images
        for ext in self.config.IMAGE_EXTENSIONS:
            found = glob.glob(ext, recursive=True)
            self.images_found.extend(found)
            
        # Scan des vidÃ©os
        for ext in self.config.VIDEO_EXTENSIONS:
            found = glob.glob(ext, recursive=True)
            self.videos_found.extend(found)
        
        self.stats['total_files'] = len(self.files_found)
        self.stats['total_images'] = len(self.images_found)
        self.stats['total_videos'] = len(self.videos_found)
        
        self.logger.info(f"   âœ… {self.stats['total_files']} pages trouvÃ©es")
        self.logger.info(f"   âœ… {self.stats['total_images']} images trouvÃ©es")
        self.logger.info(f"   âœ… {self.stats['total_videos']} vidÃ©os trouvÃ©es")
        
    def should_exclude(self, filename: str) -> bool:
        """VÃ©rifie si un fichier doit Ãªtre exclu"""
        for excluded in self.config.EXCLUDED_FILES:
            if excluded in filename:
                return True
        return False
    
    def get_file_info(self, filename: str) -> Dict:
        """RÃ©cupÃ¨re les infos dÃ©taillÃ©es d'un fichier"""
        try:
            stat = os.stat(filename)
            file_hash = hashlib.md5(open(filename, 'rb').read()).hexdigest()[:8]
            return {
                'size': stat.st_size,
                'modified': datetime.fromtimestamp(stat.st_mtime).strftime(self.config.DATE_FORMAT),
                'hash': file_hash,
                'exists': True
            }
        except Exception as e:
            self.logger.warning(f"âš ï¸ Erreur sur {filename}: {e}")
            return {
                'size': 0,
                'modified': datetime.now().strftime(self.config.DATE_FORMAT),
                'hash': 'unknown',
                'exists': False
            }
    
    def get_priority(self, filename: str) -> float:
        """PrioritÃ© intelligente basÃ©e sur le fichier"""
        return self.config.PAGE_PRIORITIES.get(filename, 0.5)
    
    def get_frequency(self, filename: str) -> str:
        """FrÃ©quence intelligente"""
        return self.config.PAGE_FREQUENCY.get(filename, 'weekly')
    
    def generate_xml(self) -> bytes:
        """GÃ©nÃ¨re le XML parfait pour Google"""
        self.logger.info("ğŸ“ GÃ©nÃ©ration du XML Google-Friendly...")
        
        # CrÃ©ation de la racine avec tous les namespaces
        urlset = Element('urlset')
        urlset.set('xmlns', 'http://www.sitemaps.org/schemas/sitemap/0.9')
        urlset.set('xmlns:image', 'http://www.google.com/schemas/sitemap-image/1.1')
        urlset.set('xmlns:video', 'http://www.google.com/schemas/sitemap-video/1.1')
        urlset.set('xmlns:xhtml', 'http://www.w3.org/1999/xhtml')
        
        # Pour chaque page
        for filename in sorted(self.files_found):
            if self.should_exclude(filename):
                self.stats['excluded'] += 1
                continue
                
            file_info = self.get_file_info(filename)
            
            # CrÃ©ation de l'URL
            url = SubElement(urlset, 'url')
            
            # LOC (URL de la page)
            loc = SubElement(url, 'loc')
            encoded_filename = urllib.parse.quote(filename)
            loc.text = f"{self.config.BASE_URL}/{encoded_filename}"
            
            # LASTMOD (derniÃ¨re modification - Google adore)
            lastmod = SubElement(url, 'lastmod')
            lastmod.text = file_info['modified']
            
            # CHANGEFREQ (frÃ©quence)
            changefreq = SubElement(url, 'changefreq')
            changefreq.text = self.get_frequency(filename)
            
            # PRIORITY (prioritÃ©)
            priority = SubElement(url, 'priority')
            priority.text = f"{self.get_priority(filename):.2f}"
            
            # HREFLANG (versions linguistiques - Google adore)
            for lang in self.config.LANGUAGES:
                link = SubElement(url, '{http://www.w3.org/1999/xhtml}link')
                link.set('rel', 'alternate')
                link.set('hreflang', lang)
                link.set('href', f"{self.config.BASE_URL}/{filename}?lang={lang}")
            
            # IMAGES associÃ©es Ã  cette page
            page_images = [img for img in self.images_found 
                          if img.startswith(os.path.splitext(filename)[0])]
            
            for img in page_images[:10]:  # Max 10 images par page (limite Google)
                img_info = self.get_file_info(img)
                image = SubElement(url, '{http://www.google.com/schemas/sitemap-image/1.1}image')
                
                img_loc = SubElement(image, '{http://www.google.com/schemas/sitemap-image/1.1}loc')
                img_loc.text = f"{self.config.BASE_URL}/{urllib.parse.quote(img)}"
                
                img_title = SubElement(image, '{http://www.google.com/schemas/sitemap-image/1.1}title')
                img_title.text = f"Image OlysaCheck - {os.path.basename(img)}"
                
                img_caption = SubElement(image, '{http://www.google.com/schemas/sitemap-image/1.1}caption')
                img_caption.text = f"Image de sÃ©curitÃ© OlysaCheck"
                
                self.stats['included_images'] += 1
            
            # VIDÃ‰OS associÃ©es
            page_videos = [vid for vid in self.videos_found 
                          if vid.startswith(os.path.splitext(filename)[0])]
            
            for vid in page_videos[:5]:  # Max 5 vidÃ©os par page
                video = SubElement(url, '{http://www.google.com/schemas/sitemap-video/1.1}video')
                
                vid_loc = SubElement(video, '{http://www.google.com/schemas/sitemap-video/1.1}content_loc')
                vid_loc.text = f"{self.config.BASE_URL}/{urllib.parse.quote(vid)}"
                
                vid_title = SubElement(video, '{http://www.google.com/schemas/sitemap-video/1.1}title')
                vid_title.text = f"VidÃ©o OlysaCheck - {os.path.basename(vid)}"
                
                vid_desc = SubElement(video, '{http://www.google.com/schemas/sitemap-video/1.1}description')
                vid_desc.text = "VidÃ©o explicative sur la sÃ©curitÃ© des donnÃ©es OlysaCheck"
                
                self.stats['included_videos'] += 1
            
            self.stats['included_urls'] += 1
        
        # CONVERSION XML PROPRE - CORRIGÃ‰
        rough_string = tostring(urlset, 'utf-8')
        reparsed = minidom.parseString(rough_string)
        
        # ğŸ”§ CORRECTION : Forcer le XML Ã  commencer par <?xml
        xml_string = reparsed.toprettyxml(indent="  ", encoding='utf-8')
        
        # S'assurer que la premiÃ¨re ligne est bien <?xml
        lines = xml_string.decode('utf-8').split('\n')
        cleaned_lines = []
        
        for line in lines:
            # Garder toutes les lignes mais enlever les vides Ã  la fin
            if line.strip() or line.startswith('<?xml') or line.startswith('<'):
                cleaned_lines.append(line.rstrip())
        
        # Reconstruire le XML
        clean_xml = '\n'.join(cleaned_lines)
        
        # VÃ©rification supplÃ©mentaire : supprimer les lignes vides multiples
        import re
        clean_xml = re.sub(r'\n\s*\n', '\n', clean_xml)
        
        return clean_xml.encode('utf-8')
    
    def save_sitemap(self, xml_content: bytes) -> bool:
        """Sauvegarde le sitemap en version normale et compressÃ©e"""
        try:
            # Version normale
            with open('sitemap.xml', 'wb') as f:
                f.write(xml_content)
            self.logger.info(f"âœ… sitemap.xml sauvegardÃ© ({len(xml_content)} octets)")
            
            # Version compressÃ©e (Google adore)
            with gzip.open('sitemap.xml.gz', 'wb') as f:
                f.write(xml_content)
            self.logger.info(f"âœ… sitemap.xml.gz sauvegardÃ© (compressÃ©)")
            
            return True
        except Exception as e:
            self.logger.error(f"âŒ Erreur sauvegarde: {e}")
            return False
    
    def generate_robotstxt(self) -> bool:
        """GÃ©nÃ¨re un robots.txt professionnel"""
        robots_content = f"""# ğŸš€ robots.txt ULTRA OPTIMISÃ‰ pour OlysaCheck
# GÃ©nÃ©rÃ© le {datetime.now().strftime("%d/%m/%Y %H:%M:%S")}
# Conforme aux directives Google

# === RÃˆGLES PRINCIPALES ===
User-agent: *
Allow: /
Allow: /sitemap.xml
Allow: /sitemap.xml.gz

# === DOSSIERS PRIVÃ‰S (non indexÃ©s) ===
Disallow: /api/
Disallow: /private/
Disallow: /temp/
Disallow: /backup/
Disallow: /old/

# === FICHIERS SPÃ‰CIFIQUES Ã€ EXCLURE ===
Disallow: /404.html
Disallow: /error.html

# === GOOGLE IMAGES ===
User-agent: Googlebot-Image
Allow: /images/
Allow: /*.jpg$
Allow: /*.png$
Allow: /*.webp$
Allow: /*.svg$

# === GOOGLE VIDÃ‰O ===
User-agent: Googlebot-Video
Allow: /videos/
Allow: /*.mp4$

# === DÃ‰LAI D'EXPLORATION (respectueux) ===
Crawl-delay: 1

# === SITEMAPS (primordial pour Google) ===
Sitemap: {self.config.BASE_URL}/sitemap.xml
Sitemap: {self.config.BASE_URL}/sitemap.xml.gz

# === HÃ”TE ===
Host: {self.config.BASE_URL}

# === DATE DE GÃ‰NÃ‰RATION ===
# Generated: {datetime.now().isoformat()}
"""
        try:
            with open('robots.txt', 'w', encoding='utf-8') as f:
                f.write(robots_content)
            self.logger.info("âœ… robots.txt sauvegardÃ©")
            return True
        except Exception as e:
            self.logger.error(f"âŒ Erreur robots.txt: {e}")
            return False
    
    def generate_html_sitemap(self) -> bool:
        """GÃ©nÃ¨re un sitemap HTML pour les humains (Google adore aussi)"""
        html_content = f"""<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan du site - OlysaCheck</title>
    <meta name="description" content="Plan du site OlysaCheck - Toutes les pages de notre plateforme de sÃ©curitÃ©">
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; }}
        h1 {{ color: #0052cc; }}
        ul {{ list-style: none; padding: 0; }}
        li {{ margin: 10px 0; }}
        a {{ color: #0052cc; text-decoration: none; }}
        a:hover {{ text-decoration: underline; }}
        .date {{ color: #666; font-size: 0.9em; margin-left: 10px; }}
    </style>
</head>
<body>
    <h1>ğŸ—ºï¸ Plan du site OlysaCheck</h1>
    <p>DÃ©couvrez toutes les pages de notre plateforme de sÃ©curitÃ© des donnÃ©es.</p>
    <ul>
"""
        for filename in sorted(self.files_found):
            if self.should_exclude(filename):
                continue
            file_info = self.get_file_info(filename)
            html_content += f'        <li><a href="{filename}">{filename}</a> <span class="date">(mis Ã  jour le {file_info["modified"]})</span></li>\n'
        
        html_content += """    </ul>
    <footer>
        <p>Â© 2026 OlysaCheck - Protection des donnÃ©es personnelles</p>
    </footer>
</body>
</html>"""
        
        try:
            with open('sitemap.html', 'w', encoding='utf-8') as f:
                f.write(html_content)
            self.logger.info("âœ… sitemap.html sauvegardÃ© (pour les humains)")
            return True
        except Exception as e:
            self.logger.error(f"âŒ Erreur sitemap.html: {e}")
            return False
    
    def validate_with_google(self, xml_content: bytes) -> Dict:
        """Valide le sitemap selon les critÃ¨res Google"""
        self.logger.info("ğŸ” Validation Google en cours...")
        
        issues = []
        warnings = []
        
        # VÃ©rification 1: Taille maximale (50MB)
        if len(xml_content) > 50 * 1024 * 1024:
            issues.append("âŒ Sitemap trop volumineux (>50MB)")
        else:
            warnings.append("âœ… Taille OK")
        
        # VÃ©rification 2: Nombre d'URLs max (50,000)
        url_count = xml_content.count(b'<url>')
        if url_count > 50000:
            issues.append(f"âŒ Trop d'URLs ({url_count} > 50000)")
        else:
            warnings.append(f"âœ… {url_count} URLs (OK)")
        
        # VÃ©rification 3: PrÃ©sence des namespaces
        if b'xmlns:image' not in xml_content:
            warnings.append("âš ï¸ Pas d'images dans le sitemap")
        
        # VÃ©rification 4: Format des dates
        if b'lastmod' in xml_content:
            warnings.append("âœ… Dates prÃ©sentes")
        
        result = {
            'valid': len(issues) == 0,
            'issues': issues,
            'warnings': warnings,
            'url_count': url_count,
            'size_kb': len(xml_content) / 1024
        }
        
        return result
    
    def show_stats(self, validation_result: Dict):
        """Affiche les statistiques dÃ©taillÃ©es"""
        print("\n" + "="*60)
        print("ğŸ“Š RAPPORT DÃ‰TAILLÃ‰ - GÃ‰NÃ‰RATION SITEMAP")
        print("="*60)
        print(f"ğŸ“ Pages trouvÃ©es         : {self.stats['total_files']}")
        print(f"ğŸ–¼ï¸  Images trouvÃ©es        : {self.stats['total_images']}")
        print(f"ğŸ¥ VidÃ©os trouvÃ©es         : {self.stats['total_videos']}")
        print(f"âœ… URLs incluses           : {self.stats['included_urls']}")
        print(f"âœ… Images incluses         : {self.stats['included_images']}")
        print(f"âœ… VidÃ©os incluses         : {self.stats['included_videos']}")
        print(f"â­ï¸  Exclus                  : {self.stats['excluded']}")
        print(f"âŒ Erreurs                 : {self.stats['errors']}")
        print("-"*60)
        print(f"ğŸ“ Taille sitemap          : {validation_result['size_kb']:.2f} KB")
        print(f"ğŸ”¢ Nombre d'URLs           : {validation_result['url_count']}")
        print("-"*60)
        print("ğŸ” VALIDATION GOOGLE :")
        for w in validation_result['warnings']:
            print(f"   {w}")
        for i in validation_result['issues']:
            print(f"   {i}")
        print("="*60)
        print(f"ğŸŒ URL de base             : {self.config.BASE_URL}")
        print(f"ğŸ“… GÃ©nÃ©rÃ© le               : {datetime.now().strftime('%d/%m/%Y %H:%M:%S')}")
        print("="*60)
        
    def run(self):
        """ExÃ©cute le processus complet"""
        print("""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     ğŸš€ GÃ‰NÃ‰RATION SITEMAP ULTRA-PUISSANT POUR GOOGLE v3.0         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  âœ“ Format XML parfait                                                 â•‘
â•‘  âœ“ Images incluses                                                    â•‘
â•‘  âœ“ VidÃ©os incluses                                                    â•‘
â•‘  âœ“ Multi-langues                                                      â•‘
â•‘  âœ“ Compression GZIP                                                   â•‘
â•‘  âœ“ Validation Google                                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        """)
        
        # Scan des fichiers
        self.scan_files()
        
        # GÃ©nÃ©ration du XML
        xml_content = self.generate_xml()
        
        # Sauvegarde
        if self.save_sitemap(xml_content):
            self.logger.info("âœ… Sitemap sauvegardÃ© avec succÃ¨s")
        else:
            self.logger.error("âŒ Ã‰chec sauvegarde sitemap")
            self.stats['errors'] += 1
        
        # GÃ©nÃ©ration des fichiers annexes
        self.generate_robotstxt()
        self.generate_html_sitemap()
        
        # Validation Google
        validation = self.validate_with_google(xml_content)
        
        # Statistiques
        self.show_stats(validation)
        
        if validation['valid']:
            print("\n" + "âœ…"*20)
            print("ğŸ‰ SUCCÃˆS ! SITEMAP PARFAIT POUR GOOGLE !")
            print("âœ…"*20)
        else:
            print("\n" + "âš ï¸"*20)
            print("ğŸ”§ CORRIGE CES POINTS AVANT DE SOUMETTRE :")
            for i in validation['issues']:
                print(f"   {i}")
            print("âš ï¸"*20)
        
        print(f"""
ğŸ“¤ FICHIERS CRÃ‰Ã‰S :
   - sitemap.xml        (format standard)
   - sitemap.xml.gz     (compressÃ© - Google adore)
   - sitemap.html       (pour les humains)
   - robots.txt         (instructions pour Google)

ğŸŒ Ã€ SOUMETTRE DANS GOOGLE SEARCH CONSOLE :
   https://olysacheck.vercel.app/sitemap.xml
   https://olysacheck.vercel.app/sitemap.xml.gz

ğŸš€ BONNE CHANCE AVEC LE RÃ‰FÃ‰RENCEMENT !
        """)
        
        # ğŸ”´ AJOUTE CES LIGNES Ã€ LA FIN POUR VÃ‰RIFIER
        self.check_vercel_deployment()
    
    def check_vercel_deployment(self):
        """VÃ©rifie si le sitemap est accessible sur Vercel"""
        print("\nğŸ” VÃ‰RIFICATION DU DÃ‰PLOIEMENT VERCEL...")
        
        # VÃ©rifie que le fichier existe localement
        if os.path.exists('sitemap.xml'):
            size = os.path.getsize('sitemap.xml')
            print(f"âœ… sitemap.xml prÃ©sent localement ({size} octets)")
            
            # Lit les premiÃ¨res lignes pour vÃ©rifier le format
            with open('sitemap.xml', 'r', encoding='utf-8') as f:
                first_line = f.readline().strip()
                if first_line.startswith('<?xml'):
                    print("âœ… Format XML correct (commence par <?xml)")
                    print(f"   PremiÃ¨re ligne : {first_line}")
                else:
                    print(f"âŒ ProblÃ¨me : premiÃ¨re ligne = {first_line}")
                    print("   Le fichier doit commencer par <?xml")
        else:
            print("âŒ sitemap.xml introuvable localement")
        
        print("\nâš ï¸ IMPORTANT :")
        print("1. Uploade ce fichier sur Vercel (via git ou dÃ©ploiement)")
        print("2. VÃ©rifie l'URL : https://olysacheck.vercel.app/sitemap.xml")
        print("3. Tu dois voir le XML, PAS une page HTML")
        print("\nğŸ“¦ Si problÃ¨me, crÃ©e un fichier vercel.json Ã  la racine :")
        print("""
{
  "cleanUrls": true,
  "trailingSlash": false,
  "headers": [
    {
      "source": "/sitemap.xml",
      "headers": [
        {
          "key": "Content-Type",
          "value": "application/xml"
        }
      ]
    }
  ]
}
        """)


# =============================================================
# ğŸš€ POINT D'ENTRÃ‰E PRINCIPAL
# =============================================================

if __name__ == "__main__":
    generator = GoogleFriendlySitemapGenerator(SitemapConfig())
    generator.run()